jQuery(document).ready(function($){function t(){var t=[],a=i.width();t.push("#dragdrop_container { width:"+a+"px; }"),$(".dragdrop").each(function(){var a=$(this).attr("id"),s="left:"+$(this).css("left")+";top:"+$(this).css("top")+";width:"+$(this).width()+"px;z-index:"+$(this).css("z-index"),d="#"+a+"{"+s+"}";t.push(d),i.attr("data-width",parseInt(i.css("width"))),$(this).attr("data-scaleleft",parseInt($(this).css("left"))).attr("data-scaletop",parseInt($(this).css("top"))).attr("data-scalewidth",$(this).width())}),r=t.toString().replace(/,/g," "),e>780?$("#dragdrop_css").val(r):$("#dragdrop_css_tablet").val(r)}function a(){var t=0;$(".dragdrop").each(function(){var a=$(this).height()+$(this).offset().top;a>t&&(t=a)}),i.height(t)}function s(){if(e>480&&!h){(!i.data("width")||i.data("width").length<1)&&i.attr("data-width",parseInt(i.css("width")));var t=e/i.data("width");e>780?i.addClass("desktop"):i.addClass("tablet"),e>780&&i.hasClass("tablet")?($(".dragdrop").attr("style","").attr("data-scaleleft","").attr("data-scaletop","").attr("data-scalewidth",""),i.attr("style","").data("width",parseInt(i.css("width"))).removeClass("tablet"),t=e/i.data("width")):780>e&&i.hasClass("desktop")&&($(".dragdrop").attr("style","").attr("data-scaleleft","").attr("data-scaletop","").attr("data-scalewidth",""),i.attr("style","").data("width",parseInt(i.css("width"))).removeClass("desktop"),t=e/i.data("width")),i.width(e),i.find(".dragdrop").each(function(){if(!$(this).data("scaleleft")||$(this).attr("data-scaleleft").length<1){var a=parseInt($(this).css("left")),s=parseInt($(this).css("top")),d=$(this).width();$(this).attr("data-scaleleft",a),$(this).attr("data-scaletop",s),$(this).attr("data-scalewidth",d)}var e=$(this).attr("data-scaleleft"),i=$(this).attr("data-scaletop"),r=$(this).attr("data-scalewidth"),h=Math.round(e*t)+"px",o=Math.round(i*t)+"px",l=Math.round(r*t)+"px";$(this).css({width:l,height:"auto",top:o,left:h})}).promise().done(function(){a()})}else a()}var d=$(window),e=d.width(),i=$("#dragdrop_container"),r;$(".logged-in .dragdrop").draggable({stack:".dragdrop",stop:function(){t(),a()}});var h=!1;$(".logged-in .dragdrop.img").each(function(){$(this).resizable({aspectRatio:!0,handles:"se",start:function(){h=!0},stop:function(){t(),a(),h=!1}})}),$(".dragdrop_positioning .submit").mouseover(function(){t()}),s(),d.resize(function(){e=d.width(),s()}),$(".dragdrop_positioning").on("submit",function(t){t.preventDefault();var a=$(this),s=a.serialize();$.ajax({type:"POST",url:sitevars.ajaxurl,data:s,success:function(){if(a.after('<div class="saved">Saved</div>'),$(".saved").delay(1e3).fadeOut(),e>780){var t=$("#dragdrop_css").val();$("#desktopcss").html(t)}else{var s=$("#dragdrop_css_tablet").val();$("#tabletcss").html("@media screen and (max-width: 780px){"+s+"}")}}})})});